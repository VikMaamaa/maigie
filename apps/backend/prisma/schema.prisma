// apps/backend/prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider             = "prisma-client-py"
  interface            = "asyncio"
  recursive_type_depth = 5
}

enum Tier {
  FREE
  PREMIUM_MONTHLY
  PREMIUM_YEARLY
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String?   // Nullable for OAuth users
  name          String?
  provider      String?   // "google", "email"
  providerId    String?
  tier          Tier      @default(FREE)
  isActive      Boolean   @default(true)
  isOnboarded   Boolean   @default(false)
  verificationCode          String?   // Stores the 6-digit OTP
  verificationCodeExpiresAt DateTime? // Stores when it expires
  passwordResetCode        String?
  passwordResetExpiresAt   DateTime?
  
  // Relation: One User has One set of Preferences
  // (We changed this from 'Json?' to a relation)
  preferences   UserPreferences?

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model UserPreferences {
  id            String    @id @default(uuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  theme         String    @default("light") // light/dark
  language      String    @default("en")
  notifications Boolean   @default(true)
  studyGoals    Json?     // Flexible JSON for specific onboarding data
}